# Film! Backend API

–ë—ç–∫–µ–Ω–¥-—á–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ Film! - –æ–Ω–ª–∞–π–Ω-—Å–µ—Ä–≤–∏—Å–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤ –≤ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä.

## –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ Nest.js —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º MongoDB –∏ PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

- `GET /` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞
- `GET /api/afisha/films/` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤
- `GET /api/afisha/films/:id/schedule` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∏–ª—å–º–∞
- `POST /api/afisha/order` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤
- `GET /content/afisha/*` - —Ä–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- `GET /api/docs` - Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

## Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

API –∏–º–µ–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, –¥–æ—Å—Ç—É–ø–Ω—É—é –ø–æ –∞–¥—Ä–µ—Å—É:

```
http://localhost:3000/api/docs
```

Swagger UI –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
- –ò–∑—É—á–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- –í–∏–¥–µ—Ç—å —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö (DTO)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js (–≤–µ—Ä—Å–∏—è 16 –∏–ª–∏ –≤—ã—à–µ)
- MongoDB/PostgreSQL (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –≤ –æ–±–ª–∞–∫–µ)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env.example` –≤ `.env` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

### –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
npm run start:dev
```

### –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

```bash
npm run build
npm run start:prod
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –ú–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### Films Module (`src/films/`)

–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∏–ª—å–º–∞–º–∏ –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º —Å–µ–∞–Ω—Å–æ–≤.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

- **DTO –∫–ª–∞—Å—Å—ã** (`dto/films.dto.ts`) - —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö
- **HTTP –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä** (`films.controller.ts`) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** (`films.service.ts`) - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å —Ñ–∏–ª—å–º–∞–º–∏
- **–ú–æ–¥—É–ª—å** (`films.module.ts`) - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è

#### Order Module (`src/order/`)

–ú–æ–¥—É–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

- **DTO –∫–ª–∞—Å—Å—ã** (`dto/order.dto.ts`) - —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–∫–∞–∑–æ–≤
- **HTTP –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä** (`order.controller.ts`) - API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∑–∞–∫–∞–∑–æ–≤
- **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** (`order.service.ts`) - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤
- **–ú–æ–¥—É–ª—å** (`order.module.ts`) - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è

#### Static Module (`src/static/`)

–ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, CSS, JS).

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

- **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä** (`static.controller.ts`) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º —Ñ–∞–π–ª–∞–º
- **–ú–æ–¥—É–ª—å** (`static.module.ts`) - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

### Repository Layer (`src/repository/`)

–°–ª–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω Repository.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å** (`films.repository.interface.ts`) - –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- **In-Memory —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** (`films.in-memory.repository.ts`) - –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **MongoDB —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** (`films.mongo.repository.ts`) - —Ä–∞–±–æ—Ç–∞ —Å MongoDB
- **PostgreSQL —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** (`films.postgres.repository.ts`) - —Ä–∞–±–æ—Ç–∞ —Å PostgreSQL
- **–ü—Ä–æ–≤–∞–π–¥–µ—Ä** (`films.repository.provider.ts`) - –≤—ã–±–æ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### Common Components (`src/common/`)

–û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤–æ –≤—Å–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

- **–§–∏–ª—å—Ç—Ä—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π** (`filters/http-exception.filter.ts`) - –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:**

- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`app.config.provider.ts`) - –ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å** (`app.module.ts`) - –∫–æ—Ä–Ω–µ–≤–æ–π –º–æ–¥—É–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞** (`main.ts`) - –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Repository Pattern

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω Repository –¥–ª—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º:

- **`IFilmsRepository`** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- **`FilmsInMemoryRepository`** - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ –ø–∞–º—è—Ç–∏ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- **`FilmsMongoRepository`** - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å MongoDB
- **`FilmsPostgresRepository`** - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å Postgre
- **`FilmsRepositoryProvider`** - –ü—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Ñ–∏–ª—å–º–æ–≤
 * –í—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è DATABASE_DRIVER:
 *  - 'inmemory' ‚Üí —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ –ø–∞–º—è—Ç–∏
 *  - 'mongodb'  ‚Üí MongoDB
 *  - 'postgres' ‚Üí PostgreSQL (TypeORM)

–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `USE_IN_MEMORY_REPOSITORY`.

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- **–ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å**: `api/afisha` (–∏—Å–∫–ª—é—á–µ–Ω–∏—è: `/`, `content/afisha/*`)
- **CORS**: –≤–∫–ª—é—á–µ–Ω –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- **–ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –∏—Å–∫–ª—é—á–µ–Ω–∏–π**: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ API
- **Swagger**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- **DTO –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ –º–µ—Å—Ç, –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏**: –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤ –æ–± –æ—à–∏–±–∫–∞—Ö

## API Endpoints

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞

```http
GET /
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "status": "ok",
  "message": "Film! API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω",
  "timestamp": "2024-08-07T02:48:36.861Z"
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤

```http
GET /api/afisha/films/
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "total": 2,
  "items": [
    {
      "id": "film-id",
      "rating": 8.5,
      "director": "–†–µ–∂–∏—Å—Å–µ—Ä",
      "tags": ["–î—Ä–∞–º–∞"],
      "title": "–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞",
      "about": "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ",
      "description": "–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ",
      "image": "/bg1s.jpg",
      "cover": "/bg1c.jpg"
    }
  ]
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Ñ–∏–ª—å–º–∞

```http
GET /api/afisha/films/:id/schedule
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "total": 3,
  "items": [
    {
      "id": "session-id",
      "daytime": "2024-06-28T10:00:00+03:00",
      "hall": 1,
      "rows": 5,
      "seats": 10,
      "price": 350,
      "taken": ["1:2", "3:5"]
    }
  ]
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

```http
POST /api/afisha/order
Content-Type: application/json

{
  "email": "user@example.com",
  "phone": "+7 (999) 123-45-67",
  "tickets": [
    {
      "film": "film-id",
      "session": "session-id",
      "row": 1,
      "seat": 1,
      "price": 350
    }
  ]
}
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "total": 1,
  "items": [
    {
      "film": "film-id",
      "session": "session-id",
      "daytime": "2024-06-28T10:00:00+03:00",
      "day": "28.06.2024",
      "time": "10:00",
      "row": 1,
      "seat": 1,
      "price": 350
    }
  ]
}
```

### –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã

```http
GET /content/afisha/bg1c.jpg
```

–°–µ—Ä–≤–∏—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –¥—Ä—É–≥–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ `public/content/afisha/`.

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MongoDB –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ñ–∏–ª—å–º–∞—Ö –∏ —Å–µ–∞–Ω—Å–∞—Ö. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `films`:

```json
{
  "id": "film-id",
  "rating": 8.5,
  "director": "–†–µ–∂–∏—Å—Å–µ—Ä",
  "tags": ["–î—Ä–∞–º–∞"],
  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞",
  "about": "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ",
  "description": "–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ",
  "image": "/bg1s.jpg",
  "cover": "/bg1c.jpg",
  "schedule": [
    {
      "id": "session-id",
      "daytime": "2024-06-28T10:00:00+03:00",
      "hall": 1,
      "rows": 5,
      "seats": 10,
      "price": 350,
      "taken": ["1:2", "3:5"]
    }
  ]
}
```

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö MongoDB

–î–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `test/mongodb_initial_stub.json`. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ MongoDB —Å –ø–æ–º–æ—â—å—é MongoDB Compass –∏–ª–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.

# –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ SQL —Å–∫—Ä–∏–ø—Ç—ã:

- **`prac.init.sql`** - –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–∞–±–ª–∏—Ü 
- **`prac.films.sql`** - –í—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤ (6 —Ñ–∏–ª—å–º–æ–≤)
- **`prac.schedules.sql`** - –í—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–µ–∞–Ω—Å–æ–≤ (54 —Å–µ–∞–Ω—Å–∞)

### –£–¥–æ–±–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:

- **`set PGCLIENTENCODING=UTF8 && psql -U postgres -d film -f test/setup_database_utf8.sql`** - –ü–æ–ª–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8(–ó–∞–ø—É—Å–∫–∞—Ç—å —Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ backend, —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ PSDB –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∫–æ–¥–∏—Ä–æ–≤–∫–∏)
- **`setup_database.bat`** - Windows bat-—Ñ–∞–π–ª –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–¥–∏—Ä–æ–≤–∫–∏


## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `films`:

```sql
CREATE TABLE films (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    rating DOUBLE PRECISION NOT NULL,
    director VARCHAR NOT NULL,
    tags TEXT NOT NULL,
    image VARCHAR NOT NULL,
    cover VARCHAR NOT NULL,
    title VARCHAR NOT NULL,
    about VARCHAR NOT NULL,
    description VARCHAR NOT NULL
);
```

### –¢–∞–±–ª–∏—Ü–∞ `schedules`:

```sql
CREATE TABLE schedules (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    daytime VARCHAR NOT NULL,
    hall INTEGER NOT NULL,
    rows INTEGER NOT NULL,
    seats INTEGER NOT NULL,
    price DOUBLE PRECISION NOT NULL,
    taken TEXT NOT NULL,
    "filmId" UUID REFERENCES films(id)
);
```

## üé¨ –§–∏–ª—å–º—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

1. **–°–æ–Ω –≤ –ª–µ—Ç–Ω–∏–π –¥–µ–Ω—å** (8.1) - –ê–º–µ–ª–∏—è –•—å—é–∑
2. **–ü–∞—Ä–∞–¥–æ–∫—Å –ù–µ–∫—Å—É—Å–∞** (9.5) - –û–ª–∏–≤–µ—Ä –ë–µ–Ω–Ω–µ—Ç
3. **–°—Ç—Ä–∞–∂–∏ –ì—Ä–∏–º—É–∞—Ä–∞** (8.9) - –õ–∏–ª–∞ –í–∞—Å–∫–µ—Å
4. **–ó–≤—ë–∑–¥–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ** (8.5) - –≠–ª–∏–∑–∞ –£–∏—Ç—Ç–∞–∫–µ—Ä
5. **–ù–µ–¥–æ—Å—Ç–∏–∂–∏–º–∞—è —É—Ç–æ–ø–∏—è** (9.0) - –•–∞—Ä—Ä–∏—Å–æ–Ω –†–∏–¥
6. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä—ã –æ–±—â–µ—Å—Ç–≤–∞** (2.9) - –ò—Ç–∞–Ω –†–∞–π—Ç

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ bat-—Ñ–∞–π–ª–∞ (Windows)

```bash
cd backend
test/setup_database.bat
```
### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω—ã–π PostgreSQL —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º (Windows)

```bash
cd backend
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL:
psql -h 127.0.0.1 -U postgres
# –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö film:
CREATE DATABASE film;
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è(–°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∏–ª—å–º–æ–≤ –∏ —Å–µ–∞–Ω—Å–æ–≤):
set PGCLIENTENCODING=UTF8 && psql -U postgres -d film -f test/setup_database_utf8.sql
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –†—É—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
chcp 65001/chcp 1251
set PGCLIENTENCODING=UTF8
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏ psql
\! chcp 1251
# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –≤ psql
psql -U postgres -d film -f test/setup_database_utf8.sql
```

### –í–∞—Ä–∏–∞–Ω—Ç 4: –ü–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
psql -U postgres -d film -f test/prac.init.sql

# 2. –í—Å—Ç–∞–≤–∫–∞ —Ñ–∏–ª—å–º–æ–≤
psql -U postgres -d film -f test/prac.films.sql

# 3. –í—Å—Ç–∞–≤–∫–∞ —Å–µ–∞–Ω—Å–æ–≤
psql -U postgres -d film -f test/prac.schedules.sql
```

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å–º–æ–≤
SELECT id, title, director, rating FROM films ORDER BY rating DESC;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∞–Ω—Å–æ–≤
SELECT s.id, f.title, s.daytime, s.hall, s.price, s.taken
FROM schedules s
JOIN films f ON s."filmId" = f.id
ORDER BY s.daytime;
```


## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –õ–∏–Ω—Ç–∏–Ω–≥

```bash
npm run lint
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Unit —Ç–µ—Å—Ç—ã
npm run test

# E2E —Ç–µ—Å—Ç—ã
npm run test:e2e
```

### –°–±–æ—Ä–∫–∞

```bash
npm run build
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

- **–í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Å—Ç**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –º–µ—Å—Ç–∞ –Ω–µ –∑–∞–Ω—è—Ç—ã –ø–µ—Ä–µ–¥ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **–§–æ—Ä–º–∞—Ç –∑–∞–Ω—è—Ç—ã—Ö –º–µ—Å—Ç**: –ú–µ—Å—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ `${row}:${seat}`
- **DTO –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –∏—Å–∫–ª—é—á–µ–Ω–∏–π**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ API

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **Repository Pattern**: –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
- **In-Memory —Ä–µ–∂–∏–º**: –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–∑–¥–∞—á–∞ —Ñ–∞–π–ª–æ–≤

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞

- **Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- **CORS**: –ù–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **TypeScript**: –ü–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å DTO**: –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ–∂–∏–¥–∞–Ω–∏—è–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤**: API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –æ–∂–∏–¥–∞–µ–º–æ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: JSON –æ—à–∏–±–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏

### –î–ª—è Windows:

```bash
chcp 65001
set PGCLIENTENCODING=UTF8
```

### –î–ª—è Linux/Mac:

```bash
export PGCLIENTENCODING=UTF8
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ö–æ–¥–∏—Ä–æ–≤–∫–∞**: –í—Å–µ —Ñ–∞–π–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç UTF-8 –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
2. **UUID**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `uuid-ossp` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ UUID
3. **–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏**: –¢–∞–±–ª–∏—Ü–∞ `schedules` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `films` —á–µ—Ä–µ–∑ `filmId`
4. **–ó–∞–Ω—è—Ç—ã–µ –º–µ—Å—Ç–∞**: –ü–æ–ª–µ `taken` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä–æ–∫—É —Å –∑–∞–Ω—è—Ç—ã–º–∏ –º–µ—Å—Ç–∞–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "—Ä—è–¥:–º–µ—Å—Ç–æ,—Ä—è–¥:–º–µ—Å—Ç–æ"

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∫–∏:

```
–û–®–ò–ë–ö–ê: –¥–ª—è —Å–∏–º–≤–æ–ª–∞ —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –±–∞–π—Ç ... –Ω–µ—Ç —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–∞ –≤ "UTF8"
```

**–†–µ—à–µ–Ω–∏–µ**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–¥–∏—Ä–æ–≤–∫—É UTF-8 –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º —Å–∫—Ä–∏–ø—Ç–∞

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

```
psql: error: connection to server at "localhost" (::1), port 5432 failed
```

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω

### –û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```
–û–®–ò–ë–ö–ê: –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö "film" –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
```

**–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `film` –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º —Å–∫—Ä–∏–ø—Ç–æ–≤
